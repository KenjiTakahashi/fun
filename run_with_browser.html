<html>
	<head>
		<style type="text/css">
			body {
				width: 900px;
				margin: 50px auto;
			}

			#parsers textarea {
				width: 700px;
				height: 400px;
			}
			
			#code {
				width: 450px;
				height: 200px;
			}
			
			#log { 
				width: 900px; 
				font-family: monospace;
				color: #333;
				margin: 50px auto;
				word-wrap: break-word;
			}
		</style>
	</head>
	<body>
		<div id="parsers">
			<div>XML Parser: </div>
			<textarea id="xml-parser"></textarea>
			<br />
			<br />
			<br />
			<div>Fun Parser, inherits from XML</div>
			<textarea id="fun-parser"></textarea>
			<br />
			<button onclick="buildParsers()">Rebuild parsers</button>
		</div>
		<br />
		<br />
		
		Fun code: <br />
		<textarea id="code"></textarea>
		<br />
		<button onclick="loadCode('if_statement.fun')">Load if_statement.fun</button>
		<button onclick="loadCode('fun_and_xml.fun')">Load fun_and_xml.fun</button>
		<button onclick="loadCode('test_xml.xml')">Load text_xml.xml</button>
		<br />
		<button onclick="runCode()">Parse code code</button>
		<div id="log"></div>
		<script type="text/javascript" src="./lib/require.js"></script>
		<script type="text/javascript">
		
		require('./lib/ometa-js/ometa-node');
		
		function getCode(path) {
			return require.get(path) + "\n"
		}
		function log(statement) {
			var logDiv = document.getElementById('log')
			logDiv.innerHTML = '<br /><div class="line">' + JSON.stringify(statement) + '</div>' + logDiv.innerHTML
			if (typeof console != 'undefined') { console.log(statement) }
		}
		
		function parseOmetaCode(parserCode) {
			try {
				ometa(parserCode)
			} catch(e) {
				var errorMsg = "Error: " + e
				if (e.errorPos) {
					errorMsg += " at pos " + e.errorPos + " >>>" + parserCode.substr(e.errorPos, 30) 
				}
				log(errorMsg)
				throw e
			}
		}

		function buildParsers() {
			parseOmetaCode(document.getElementById('xml-parser').value)
			parseOmetaCode(document.getElementById('fun-parser').value)
		}

		function loadCode(file) {
			var code = getCode('sample_input/' + file)
			document.getElementById('code').value = code
		}
		
		function runCode() {
			var code = document.getElementById('code').value
			var tree = FunParser.matchAll(code, "FunTop")
			log('AST: ' + tree)
		}
		
		document.getElementById('xml-parser').value = getCode('parsers/xml.ometa')
		document.getElementById('fun-parser').value = getCode('parsers/fun.ometa')
		
		buildParsers()
		runCode()
		
		// var translated = FunTranslator.matchAll(tree, "FunTop")
		// sys.puts(translated)
		// 
			
		</script>
		
	</body>
</html>